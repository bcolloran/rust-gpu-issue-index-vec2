
bc@bc-mint-22-2024:/data/code_projects/rust/rust-gpu-issue-index-vec2$ cargo run --features variable_pointers variable_pointers_storage_buffer
warning: rust-gpu-issue-index-vec2@0.1.0: building SPIRV to: /data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv
warning: rust-gpu-issue-index-vec2@0.1.0: SPIRV entry points: index_vec2
   Compiling rust-gpu-issue-index-vec2 v0.1.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.50s
     Running `target/debug/rust-gpu-issue-index-vec2 variable_pointers_storage_buffer`
Spir-V shader byte length: 227128
Segmentation fault (core dumped)


bc@bc-mint-22-2024:/data/code_projects/rust/rust-gpu-issue-index-vec2$ cargo run
   Compiling rust-gpu-issue-index-vec2 v0.1.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2)
error: failed to run custom build command for `rust-gpu-issue-index-vec2 v0.1.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2)`

Caused by:
  process didn't exit successfully: `/data/code_projects/rust/rust-gpu-issue-index-vec2/target/debug/build/rust-gpu-issue-index-vec2-bd3276fa397dd4b3/build-script-build` (exit status: 101)
  --- stdout
  cargo:rerun-if-env-changed=RUSTGPU_CODEGEN_ARGS
  cargo:rerun-if-env-changed=RUSTGPU_RUSTFLAGS
  cargo:rerun-if-env-changed=RUSTGPU_CARGOFLAGS

  --- stderr
     Compiling kernels v0.0.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2/kernels)
  error: Using pointers with OpPhi requires capability VariablePointers or VariablePointersStorageBuffer
    |
    = note: module `/data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv`

  warning: an unknown error occurred
    |
    = note: spirv-opt failed, leaving as unoptimized
    = note: module `/data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv`

  error: error:0:0 - Using pointers with OpPhi requires capability VariablePointers or VariablePointersStorageBuffer
           %62 = OpPhi %_ptr_StorageBuffer_float %60 %58 %61 %59
    |
    = note: spirv-val failed
    = note: module `/data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv`

  warning: `kernels` (lib) generated 1 warning
  error: could not compile `kernels` (lib) due to 2 previous errors; 1 warning emitted

  thread 'main' panicked at build.rs:24:10:
  called `Result::unwrap()` on an `Err` value: BuildFailed
  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


bc@bc-mint-22-2024:/data/code_projects/rust/rust-gpu-issue-index-vec2$ cargo run --features variable_pointers variable_pointers_storage_buffer
warning: rust-gpu-issue-index-vec2@0.1.0: building SPIRV to: /data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv
warning: rust-gpu-issue-index-vec2@0.1.0: SPIRV entry points: index_vec2
   Compiling rust-gpu-issue-index-vec2 v0.1.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.51s
     Running `target/debug/rust-gpu-issue-index-vec2 variable_pointers_storage_buffer`
Spir-V shader byte length: 227128
Segmentation fault (core dumped)


// ========================================
// added the line to build.rs here
// ========================================


bc@bc-mint-22-2024:/data/code_projects/rust/rust-gpu-issue-index-vec2$ cargo run --features variable_pointers variable_pointers_storage_buffer
   Compiling rust-gpu-issue-index-vec2 v0.1.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2)
warning: rust-gpu-issue-index-vec2@0.1.0: building SPIRV to: /data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv
warning: rust-gpu-issue-index-vec2@0.1.0: SPIRV entry points: index_vec2
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 2.58s
     Running `target/debug/rust-gpu-issue-index-vec2 variable_pointers_storage_buffer`
Spir-V shader byte length: 2224
Data before running compute shader (first 10 elts): [Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0)]
Data after running compute shader (first 10 elts): [Vec2(1.0, 1.01), Vec2(2.00001, 2.01002), Vec2(3.00002, 3.01004), Vec2(4.00003, 4.0100603), Vec2(5.00004, 5.0100803), Vec2(6.00005, 6.0101004), Vec2(7.00006, 7.0101204), Vec2(8.00007, 8.01014), Vec2(9.00008, 9.01016), Vec2(10.00009, 10.01018)]


bc@bc-mint-22-2024:/data/code_projects/rust/rust-gpu-issue-index-vec2$ cargo run
   Compiling rust-gpu-issue-index-vec2 v0.1.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2)
error: failed to run custom build command for `rust-gpu-issue-index-vec2 v0.1.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2)`

Caused by:
  process didn't exit successfully: `/data/code_projects/rust/rust-gpu-issue-index-vec2/target/debug/build/rust-gpu-issue-index-vec2-bd3276fa397dd4b3/build-script-build` (exit status: 101)
  --- stdout
  cargo:rerun-if-changed=kernel/src
  cargo:rerun-if-env-changed=RUSTGPU_CODEGEN_ARGS
  cargo:rerun-if-env-changed=RUSTGPU_RUSTFLAGS
  cargo:rerun-if-env-changed=RUSTGPU_CARGOFLAGS

  --- stderr
     Compiling kernels v0.0.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2/kernels)
  error: Using pointers with OpPhi requires capability VariablePointers or VariablePointersStorageBuffer
    |
    = note: module `/data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv`

  warning: an unknown error occurred
    |
    = note: spirv-opt failed, leaving as unoptimized
    = note: module `/data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv`

  error: error:0:0 - Using pointers with OpPhi requires capability VariablePointers or VariablePointersStorageBuffer
           %62 = OpPhi %_ptr_StorageBuffer_float %60 %58 %61 %59
    |
    = note: spirv-val failed
    = note: module `/data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv`

  warning: `kernels` (lib) generated 1 warning
  error: could not compile `kernels` (lib) due to 2 previous errors; 1 warning emitted

  thread 'main' panicked at build.rs:24:10:
  called `Result::unwrap()` on an `Err` value: BuildFailed
  note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace


bc@bc-mint-22-2024:/data/code_projects/rust/rust-gpu-issue-index-vec2$ cargo run --features variable_pointers variable_pointers_storage_buffer
   Compiling rust-gpu-issue-index-vec2 v0.1.0 (/data/code_projects/rust/rust-gpu-issue-index-vec2)
warning: rust-gpu-issue-index-vec2@0.1.0: building SPIRV to: /data/code_projects/rust/rust-gpu-issue-index-vec2/target/spirv-builder/spirv-unknown-vulkan1.4/release/deps/kernels.spv
warning: rust-gpu-issue-index-vec2@0.1.0: SPIRV entry points: index_vec2
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 2.24s
     Running `target/debug/rust-gpu-issue-index-vec2 variable_pointers_storage_buffer`
Spir-V shader byte length: 2224
Data before running compute shader (first 10 elts): [Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0), Vec2(1.0, 2.0)]
Data after running compute shader (first 10 elts): [Vec2(1.0, 1.01), Vec2(2.00001, 2.01002), Vec2(3.00002, 3.01004), Vec2(4.00003, 4.0100603), Vec2(5.00004, 5.0100803), Vec2(6.00005, 6.0101004), Vec2(7.00006, 7.0101204), Vec2(8.00007, 8.01014), Vec2(9.00008, 9.01016), Vec2(10.00009, 10.01018)]



